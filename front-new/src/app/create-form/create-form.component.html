<div class="card flex justify-content-center">
    <p-stepper>
        <p-stepperPanel header="Form Configuration">
            <ng-template pTemplate="content" let-nextCallback="nextCallback" let-index="index">
                <div class="flex flex-column h-12rem">
                    <div class="form-container border-2 border-dashed surface-border border-round surface-ground flex-auto flex justify-content-center align-items-center font-medium">
                        <div class="centered-container">
                            <p-floatLabel>
                                <input pInputText id="title" [(ngModel)]="form.title"/>
                                <label for="title">Form Title</label>
                            </p-floatLabel>
                        </div>

                        <div class="centered-container">
                            <p-floatLabel>
                                <textarea
                                        rows="5"
                                        cols="30"
                                        pInputTextarea
                                        [autoResize]="true" id="desc" [(ngModel)]="form.description">
                                </textarea>
                                <label for="desc">Description</label>
                            </p-floatLabel>
                        </div>

                        <div class="centered-container">
                            <p-floatLabel>
                                <input pInputText id="userMail" [(ngModel)]="form.userEmail"/>
                                <label for="userMail">User Email</label>
                            </p-floatLabel>
                        </div>

                        <div class="centered-container">
                            <p-toggleButton
                                    [(ngModel)]="form.escalate"
                                    onLabel="Escalate On"
                                    offLabel="Escalate Off"/>
                        </div>
                        <div *ngIf="form.escalate" class="centered-container">
                            <p-floatLabel>
                                <input pInputText id="managerMail" [(ngModel)]="form.managerEmail"/>
                                <label for="managerMail">User Email</label>
                            </p-floatLabel>
                        </div>
                    </div>
                    <div class="flex pt-4 justify-content-end">
                        <p-button
                                label="Next"
                                icon="pi pi-arrow-right"
                                iconPos="right"
                                (onClick)="nextCallback.emit()"/>
                    </div>
                </div>
            </ng-template>
        </p-stepperPanel>
        <p-stepperPanel header="Add Fields">
            <ng-template pTemplate="content" let-prevCallback="prevCallback" let-nextCallback="nextCallback"
                         let-index="index">
                <div class="flex flex-column">
                    <div class="border-2 border-dashed surface-border border-round surface-ground p-4 font-medium">

                        <!-- Boucle principale pour chaque question -->
                        <div *ngFor="let question of form.questions; let i = index"
                             class="question-wrapper flex align-items-start mb-4">

                            <!-- Conteneur de la question -->
                            <div class="question-content flex-grow-1">

                                <!-- Titre de la question -->
                                <div class="full-width-input mb-2">
                                    <p-floatLabel>
                                        <input pInputText [(ngModel)]="question.text" required/>
                                        <label>Question sans titre</label>
                                    </p-floatLabel>
                                </div>

                                <!-- Type de question -->
                                <div class="full-width-input mb-2">
                                    <p-dropdown [(ngModel)]="question.type" placeholder="Type de question"
                                                [options]="questionTypes">
                                    </p-dropdown>
                                </div>

                                <!-- Bouton pour ajouter une option (visible si le type de question n'est pas 'text') -->
                                <div *ngIf="question.type !== 'text'" class="mb-2">
                                    <button pButton type="button" icon="pi pi-plus"
                                            class="p-button-rounded p-button-primary"
                                            (click)="addOption(i)">
                                    </button>
                                </div>

                                <!-- Options pour les types de questions spécifiques -->
                                <div *ngIf="['multipleChoice', 'checkbox', 'dropdown'].includes(question.type)">
                                    <div *ngFor="let option of question.options; let j = index"
                                         class="option-container flex align-items-center mb-2">
                                        <div class="option-field flex-auto">
                                            <p-floatLabel>
                                                <input pInputText [(ngModel)]="question.options[j]" required/>
                                                <label>Option</label>
                                            </p-floatLabel>
                                        </div>
                                        <button pButton type="button" icon="pi pi-trash"
                                                class="p-button-rounded p-button-danger ml-2"
                                                (click)="removeOption(i, j)">
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Barre latérale (sidebar) avec les boutons d'action -->
                            <div class="sidebar ml-3">
                                <button pButton type="button" icon="pi pi-plus"
                                        class="p-button-rounded p-button-primary mb-2"
                                        (click)="addQuestion()" title="Ajouter une question">
                                </button>
                                <button pButton type="button" icon="pi pi-trash"
                                        class="p-button-rounded p-button-danger mb-2"
                                        (click)="removeQuestion(i)" title="Supprimer la question">
                                </button>
                                <button pButton type="button" icon="pi pi-copy"
                                        class="p-button-rounded p-button-secondary"
                                        (click)="duplicateQuestion(i)" title="Dupliquer la question">
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Boutons de navigation -->
                    <div class="flex pt-4 justify-content-between">
                        <p-button label="Back" icon="pi pi-arrow-left" (onClick)="prevCallback.emit()"></p-button>
                        <p-button label="Next" icon="pi pi-arrow-right" iconPos="right"
                                  (onClick)="nextCallback.emit()"></p-button>
                    </div>
                </div>
            </ng-template>
        </p-stepperPanel>
        <p-stepperPanel header="Submit">
            <ng-template pTemplate="content" let-prevCallback="prevCallback" let-index="index">
                <div class="flex flex-column h-12rem">
                    <div class="border-2 border-dashed surface-border border-round surface-ground flex-auto flex justify-content-center align-items-center font-medium">
                        Content III
                    </div>
                </div>
                <div class="flex pt-4 justify-content-start">
                    <p-button
                            label="Back"
                            icon="pi pi-arrow-left"
                            (onClick)="prevCallback.emit()"/>
                </div>
            </ng-template>
        </p-stepperPanel>
    </p-stepper>
</div>
