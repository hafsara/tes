<div class="tokens-header">
  <h2>API Tokens</h2>
  <button pButton label="New Token" icon="pi pi-plus" class="p-button-rounded p-button-primary" (click)="showCreateTokenDialog()"></button>
</div>

<p-table [value]="tokens" *ngIf="tokens && tokens.length > 0">
  <ng-template pTemplate="header">
    <tr>
      <th>Name</th>
      <th>Application</th>
      <th>Expires</th>
      <th>Created</th>
      <th>Actions</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-token>
    <tr>
      <td>{{ token.token_name }}</td>
      <td>{{ token.app_names.join(', ') }}</td>
      <td>{{ token.expiration | date }}</td>
      <td>{{ token.created_at | date }}</td>
      <td>
        <button pButton icon="pi pi-trash" class="p-button-rounded p-button-danger" (click)="revokeToken(token.token)"></button>
      </td>
    </tr>
  </ng-template>
</p-table>

<div *ngIf="!tokens || tokens.length === 0" class="empty-state">
  <p>You have no personal API tokens yet.</p>
</div>

<p-dialog [(visible)]="displayCreateTokenDialog" header="Create New Token" [modal]="true" [style]="{ width: '400px' }">
  <div class="p-fluid">
    <div class="field">
      <label for="token_name">Token Name</label>
      <input pInputText id="token_name" [(ngModel)]="newToken.token_name" placeholder="Enter token name" />
    </div>
    <div class="field">
      <label for="applications">Applications</label>
      <p-multiselect
        id="applications"
        [options]="appOptions"
        [(ngModel)]="newToken.app_names"
        optionLabel="name"
        display="chip"
        placeholder="Select Applications"
      ></p-multiselect>
    </div>
  </div>
  <div class="p-dialog-footer">
    <button pButton label="Cancel" icon="pi pi-times" class="p-button-text" (click)="hideCreateTokenDialog()"></button>
    <button pButton label="Create" icon="pi pi-check" class="p-button-primary" (click)="createToken()"></button>
  </div>
</p-dialog>
