<div class="tokens-header">
  <h2>Workflow Manager</h2>
  <button pButton label="New workflow" icon="pi pi-plus" class="p-button-rounded p-button-primary"></button>
</div>

<div class="workflow-container">
  <div cdkDropList [cdkDropListData]="steps" (cdkDropListDropped)="drop($event)" class="workflow-container">
    <div *ngFor="let step of steps" cdkDrag class="draggable-step">
      <p-panel [header]="step.label"
               class="step-panel"
               [collapsed]="true"
               toggleable="true">
        <ng-template pTemplate="icons">
          <button class="p-panel-header-icon p-link mr-2" (click)="openContextMenu($event, step, menu)">
            <span class="pi pi-cog"></span>
          </button>
          <p-menu #menu id="config_menu" [model]="items" [popup]="true"/>
        </ng-template>

        <div class="step-details">
          <p>Type: {{ step.type }}</p>
          <p>Delay: {{ step.delay }} days</p>
        </div>
      </p-panel>
    </div>
  </div>

  <div class="workflow-actions">
    <p-button label="Add Step" icon="pi pi-plus" (click)="addStep()"></p-button>
    <p-button label="Save" icon="pi pi-save" class="p-button-success" (click)="saveWorkflow()"></p-button>
  </div>
</div>

<p-dialog [(visible)]="displayDialog" *ngIf="selectedStep">
  <h3>{{ isEditing ? 'Edit Step' : 'Add Step' }}</h3>
  <div>
    <label>Type:</label>
    <p-dropdown [options]="availableTypes" [(ngModel)]="selectedStep.type"
                [disabled]="selectedStep.type === 'start'"></p-dropdown>
  </div>
  <div>
    <label>Delay (days):</label>
    <input type="number" pInputText [(ngModel)]="selectedStep.delay">
  </div>
  <p-button label="Confirm" (click)="isEditing ? updateStep() : confirmAddStep()"></p-button>
</p-dialog>

<p-dialog [(visible)]="displayWorkflowDialog">
  <h3>Save Workflow</h3>
  <div>
    <label>Workflow Name:</label>
    <input type="text" pInputText [(ngModel)]="workflowName">
  </div>
  <p-button label="Save" icon="pi pi-save" class="p-button-success" (click)="confirmSaveWorkflow()"></p-button>
</p-dialog>

